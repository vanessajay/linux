<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>

<meta content="text/html; charset=ISO-8859-1" http-equiv="Content-Type">
<style type="text/css" media="all">
@import "ntp.css";
</style>
<meta content="Comitê Gestor da Internet no Brasil" name="Description">
<meta content="text/html; charset=ISO-8859-1" http-equiv="content-type"><title>NTP.br</title></head><body>
<table class="principal" cellpadding="0" cellspacing="0">
<tbody>
<tr>
<td colspan="2" class="tabela-top">
<table class="principal">
<tbody>
<tr>
<td class="princip02-01">&nbsp;</td>

<td class="princip02-01">&nbsp;</td>
<td class="princip02-01"></td>
</tr>
<tr>
<td class="princip02-01"></td>
<td class="cont-menusup">
<table class="principal">
<tbody>
<tr>
<td><a href="http://www.cgi.br/" class="link-cgi"><b>Comitê Gestor da
Internet no Brasil </b></a></td>
<td align="right"></td>
</tr>
</tbody>
</table>

</td>
<td class="princip02-01"></td>
</tr>
<tr>
<td class="princip01"><img src="ntp_arquivos/nic-04.png" alt="" 
width="21" height="32"></td>
<td class="princip02-02" valign="top"><!-- Inicio Menu Superior -->
<table class="menusup">
<tbody>
<tr>
<td> <a href="http://www.nic.br/" class="menusup">NIC.br</a>&nbsp;&nbsp;
|&nbsp;&nbsp; <a href="http://www.cetic.br/" class="menusup">CETIC.br</a>&nbsp;&nbsp;
|&nbsp;&nbsp;
 <a href="http://www.antispam.br/" class="menusup">Antispam.br</a>&nbsp;&nbsp;

|&nbsp;&nbsp;
 <a href="http://www.ceptro.br/" class="menusup">CEPTRO.br</a>
</td>
<td class="menusup-right"><a href="http://www.nic.br/imprensa/" 
class="menusup">Imprensa</a></td>
</tr>
</tbody>
</table>
<!-- Fim Menu Superior --> </td>
<td class="princip01"><img src="ntp_arquivos/nic-06.png" alt="" 
width="20" height="32"></td>

</tr>
</tbody>
</table>
</td>
<td rowspan="2" class="logo-home"> <a href="http://www.nic.br/"><img 
src="ntp_arquivos/nic-03a.png" alt=""></a>
<div class="direita"> <img src="ntp_arquivos/barra-logos-int.png" alt=""
 usemap="#logo"></div>
<map name="logo"><area shape="rect" coords="22,4,104,58" 
href="http://www.cgi.br/" alt="CGI.br" title="CGI.br"><area shape="rect"
 coords="109,16,167,31" href="http://registro.br/" alt="Registro" 
title="Registro"><area shape="rect" coords="109,34,165,50" 
href="http://www.cert.br/" alt="CERT.br" title="CERT.br"></map>
</td>
</tr>
<tr>
<td rowspan="2" class="chama-menuleft">
<table class="menuleft-tabela" border="0" cellpadding="0" 
cellspacing="0">
<tbody>
<tr>
<td rowspan="2" class="menuleft-fundo03">

<p class="logo-left"><a href="http://ntp.br/"><img 
src="ntp_arquivos/logo-ntp.gif" alt=""></a></p>
<ul id="navlist">
<li><a href="http://www.ntp.br/index.html">Introdução</a></li>
<li><a href="http://www.ntp.br/guia.html">Guia
Rápido</a></li>
<li><a href="http://www.ntp.br/tempo.html">O Tempo</a></li>
<li><a href="http://www.ntp.br/ntp.html">O NTP</a></li>
<li><a href="http://www.ntp.br/estrutura.html">Estrutura</a></li>
<li><a href="http://www.ntp.br/utilizando.html">Utilizando</a></li>
<li><a href="http://www.ntp.br/vocabulario.html">Vocabulário</a></li>

<li><a href="http://www.ntp.br/faq.html">FAQ</a></li>
<li><a href="http://www.ntp.br/links.html">Links</a></li>
<li><a href="http://www.ntp.br/contato.html">Contato</a></li>
</ul>
</td>
<td class="menuleft-fundo02"></td>
</tr>
<tr>
<td class="menuleft-fundo01"></td>
</tr>
</tbody>
</table>
<form method="get" action="http://www.google.com/search">
<table class="menuleft-busca" border="0" cellpadding="0" cellspacing="0">

<tbody>
<tr>
<td rowspan="3" class="menuleft-busca03">
<p class="logo-busca"><img src="ntp_arquivos/tit-busca.png" alt=""></p>
<table class="busca" cellpadding="0" cellspacing="0">
<tbody>
<tr>
<td>&nbsp;</td>
<td class="busca"><input size="12" name="q" maxlength="255" 
class="busca" type="text">
<input name="domains" 
value="nic.br;cetic.br;ceptro.br;ptt.br;ntp.br;cert.br;registro.br;" 
type="hidden"><input name="ie" value="iso-8859-1" type="hidden"> <input 
name="oe" value="iso-8859-1" type="hidden"> </td>
<td class="busca">&nbsp;&nbsp;</td>
<td class="busca"><input src="ntp_arquivos/bus03.png" name="sa" 
value="ok" alt="ok" type="image"></td>
</tr>
</tbody>
</table>

<table class="busca-radio">
<tbody>
<tr>
<td><input name="sitesearch" value="nic.br" type="radio">NIC.br</td>
<td><input name="sitesearch" value="cetic.br" type="radio">CETIC.br</td>
</tr>
<tr>
<td><input name="sitesearch" value="ceptro.br" type="radio">CEPTRO.br</td>
<td><input name="sitesearch" value="registro.br" type="radio">Registro.br</td>
</tr>
<tr>
<td><input name="sitesearch" value="ptt.br" type="radio">PTT.br</td>
<td><input name="sitesearch" value="ntp.br" checked="checked" 
type="radio">NTP.br</td>
</tr><tr>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
</tbody>
</table>
</td>
<td class="menuleft-fundo04"></td>
</tr>

<tr>
<td class="menuleft-busca02"></td>
</tr>
<tr>
<td class="menuleft-fundo01"></td>
</tr>
</tbody>
</table>
</form>
</td>
<td class="titulos"><table class="principal">
  <tbody><tr>
    <td class="divisa-centro02">&nbsp;</td>
    <td>
	<p class="mar-titulos"><img src="ntp_arquivos/tit-ntp.png" 
alt="tit-ntp.png"></p>
</td>
    <td class="divisa-centro03">&nbsp;</td>
  </tr>
</tbody></table>
</td>
</tr>
<tr>
<td colspan="2" class="conteudo">
<table style="width: 100%;" class="principal">
<tbody>

<tr>
<td class="divisa-centro">&nbsp;</td>
<td><a name="inicio"></a><!-- inicio conteudo -->

<span style="font-weight: bold;">NTP</span> significa<span 
style="font-style: italic;"> Network Time Protocol</span>
ou <span style="font-weight: bold;">Protocolo de Tempo
para Redes</span>. É o protocolo
que permite a sincronização dos
relógios dos
dispositivos de uma rede como servidores,
estações de
trabalho, roteadores e outros equipamentos à partir de
referências de tempo confiáveis.



<span style="font-weight: bold; color: rgb(153, 0, 0);"><br>
<br>
OBS:</span> <span style="color: rgb(51, 51, 51);">ao longo desta página 
utiliza-se o comando <span style="font-style: italic; font-weight: 
bold;">ntpq</span>

da distribuição do NTP para exemplificar o acesso
às variaveis do sistema ligadas a cada conceito. Para mais
detalhes sobre essa ferramenta, deve-se acessar a seção</span> <a 
href="http://www.ntp.br/utilizando.html">Utilizando.</a><br>
<br>
<ul>
<li><a href="#Arquitetura">Arquitetura do NTP</a></li>
<li><a href="#Funcionamento">O Funcionamento do NTP</a></li>
<li><a href="#Mensagens">Troca de Mensagens e Cálculo do Deslocamento</a></li>
<li><a href="#Filtro">O Algorítmo de Filtro de Relógio</a></li>
<li><a href="#Selecao">O Algorítimo de Seleção dos Relógios</a><a 
href="#Filtro"></a></li>
<li><a href="#Agrupamento">O Algorítmo de Agrupamento</a></li>
<li><a href="#Combina%E7%E3o">O Algorítmo de Combinação de Relógios</a></li>
<li><a href="#Disciplina">Disciplina do Relógio Local</a></li>
<li><a href="#Seguranca">Segurança</a></li>
</ul>


<p class="voltar-top"><a href="#inicio" name="Arquitetura">Voltar</a></p>



<a name="Arquitetura"></a><span class="titulo">Arquitetura
do NTP</span><br>
<br>
Os servidores NTP formam uma topologia hierárquica, dividida
em camadas ou estratos (em inglês: <span style="font-style: italic;">strata</span>)
 numerados
de 0 (zero) a 16 (dezesseis). O estrato 0 <span style="font-style: 
italic;">(stratum 0)</span> na
verdade não faz parte da rede de servidores NTP, mas
representa a referência primária de tempo, que

é geralmente um receptor do Sistema de Posicionamento Global
(GPS) ou um relógio atômico. O estrato 16&nbsp;<span style="font-style: 
italic;"></span>indica que um determinado servidor está inoperante.<br><br>
<div style="text-align: center;"><img title="Hierarquia NTP - Estratos 
de 1 a 4" style="width: 408px; height: 177px;" 
src="ntp_arquivos/ntp-st.gif" alt="ntp-st.gif"><br></div><div 
style="text-align: center;"><small style="font-weight: bold;">Figura 1: 
Topologia em camadas (estratos) </small><br></div><br>O estrato 0, ou 
relógio de referência, fornece o
tempo correto para o estrato 1, que por sua vez fornece o tempo para o
estrato 2 e assim por diante. O NTP é então,
simultaneamente, servidor (fornece o tempo) e cliente (consulta o
tempo). A topologia está ilustrada na <span style="font-weight: bold;">Figura
 1</span>.<br>

<br>
De forma geral, quanto mais perto da raiz, ou seja, do estrato 0, maior
a exatidão do tempo. O estrato ao qual o servidor pertence
é a principal métrica utilizada pelo NTP para escolher
dentre vários, qual o melhor servidor para fornecer o tempo. <br><br>Por
 outro lado, normalmente as
diferenças de exatidão entre os estratos
não são expressivas e há, no momento
de
escolher-se um conjunto de servidores de tempo para configurar um 
determinado cliente, outros fatores a se
considerar, como por exemplo&nbsp;a carga
à qual os servidores estão submetidos, e o atraso de rede.<br>

<br>
O estrato
de um servidor não é uma
característica
estática. Se houver perda de conexão com as
fontes de
tempo, ou outros fatores que modifiquem a topologia da rede, o estrato
pode variar.<br><br>Ao consultar-se a lista de servidores no <span 
style="font-style: italic;">daemon</span> NTP, o estrato (<span 
style="font-style: italic;">st</span>) é informado:<br><br>

<div style="margin-left: 40px;"><span style="font-family: monospace; 
color: rgb(0, 51, 0);">usuario@cliente.local:~$
<span style="font-weight: bold;">ntpq
-c pe</span></span><br style="font-family: monospace;"><span 
style="font-family: monospace;"><span style="font-weight: bold;"></span></span><span
 style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp; 
remote&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
refid&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="font-weight: bold;">st</span>
 t when poll reach&nbsp;&nbsp; delay&nbsp;&nbsp; offset&nbsp; jitter</span><br
 style="color: black;"><span style="font-family: monospace; color: 
black;">==============================================================================</span><br
 style="color: black;"><span style="font-family: monospace; color: 
black;">-servidor1 &nbsp; &nbsp; &nbsp; 
.IRIG.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
 style="font-weight: bold;">1</span> u&nbsp;&nbsp;&nbsp; 8&nbsp;&nbsp; 
32&nbsp; 377&nbsp;&nbsp;&nbsp; 0.407&nbsp;&nbsp;&nbsp; 0.248&nbsp;&nbsp;
 0.016</span><br style="color: black;"><span style="font-family: 
monospace; color: black;">-servidor2 &nbsp; &nbsp; &nbsp; 
.GPS.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
 style="font-weight: bold;">1</span> u&nbsp;&nbsp;&nbsp; -&nbsp;&nbsp; 
32&nbsp; 377&nbsp;&nbsp;&nbsp; 0.474&nbsp;&nbsp;&nbsp; 0.213&nbsp;&nbsp;
 0.019</span><br style="color: black;"><span style="font-family: 
monospace; color: black;">+servidor3 &nbsp; &nbsp; &nbsp; 
.GPS.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
 style="font-weight: bold;">1</span> u&nbsp;&nbsp;&nbsp; 9&nbsp;&nbsp; 
64&nbsp; 377&nbsp;&nbsp; 15.680&nbsp;&nbsp; -0.005&nbsp;&nbsp; 0.026</span><br
 style="color: black;"><span style="font-family: monospace; color: 
black;">+servidor4 &nbsp; &nbsp; &nbsp; 
.IRIG.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span 
style="font-weight: bold;"> 1</span> u&nbsp;&nbsp; 30&nbsp;&nbsp; 
64&nbsp; 377&nbsp;&nbsp; 15.582&nbsp;&nbsp;&nbsp; 0.004&nbsp;&nbsp; 
0.100</span><br style="color: black;"><span style="font-family: 
monospace; color: black;">*servidor5&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; 
.GPS.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
 style="font-weight: bold;">1</span> u&nbsp;&nbsp; 10&nbsp;&nbsp; 
32&nbsp; 377&nbsp;&nbsp;&nbsp; 0.400&nbsp;&nbsp; -0.026&nbsp;&nbsp; 
0.049</span><br style="color: black;"><span style="font-family: 
monospace; color: black;">xservidor6 &nbsp; &nbsp; &nbsp; 
.IRIG.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
 style="font-weight: bold;">1</span> u&nbsp;&nbsp; 26&nbsp;&nbsp; 
64&nbsp; 377&nbsp;&nbsp;&nbsp; 7.824&nbsp;&nbsp;&nbsp; 9.923&nbsp;&nbsp;
 0.367</span><br></div><br><br>As relações entre os diferentes 
dispositivos NTP são normalmente chamadas de <span style="font-weight: 
bold;">Associações</span>. Elas podem ser: <br><ul><li><span 
style="font-weight: bold;">Permanentes:&nbsp;</span>são criadas por uma 
configuração ou comando e mantidas sempre.<br><br></li><li><span 
style="font-weight: bold;">Priorizáveis</span> (<span style="font-style:
 italic;">preemptables): </span>são
específicas da versão 4 do NTP e criadas por uma
configuração ou comando, podem ser desfeitas no caso de
haver um servidor melhor, ou depois de um certo tempo.<br><br></li><li><span
 style="font-weight: bold;">Efêmeras ou transitórias:</span>&nbsp;são
criadas por solicitação de outro dispositivo NTP e podem
ser desfeitas em caso de erro ou depois de um certo tempo.</li></ul><br>São
 possíveis as seguintes Associações:<br><ul>

<li><span style="font-weight: bold;">Cliente
- Servidor: </span><span style="font-style: italic;">(client
- server)</span> É uma associação permanente e a forma mais comum de
configuração. Um dispositivo faz o papel de <span style="font-weight: 
bold;">cliente</span>, solicitando informações sobre o tempo a um 
servidor. O cliente tem
conhecimento das associações com os servidores e do estado da troca de 
pacotes. Outro dispositivo faz o
papel de <span style="font-weight: bold;">servidor</span>, respondendo à
 solicitação do cliente com informações sobre o tempo.
O servidor não armazena informações sobre o
diálogo com o cliente ou sobre sua associação com o mesmo.&nbsp;<br><br>No
 processo, então, o cliente envia um pacote ao
servidor a
aguarda a resposta, que vem em seguida. Isso pode ser descrito
também como uma operação do tipo <span style="font-style: italic;">pull</span>,
 dizendo que o
cliente busca os dados necessários sobre o tempo no servidor.<br>

<br>
Para configurar o cliente dessa forma é usado o
parâmetro <span style="font-family: monospace; font-weight: bold;">server</span>
no arquivo de configuração, seguido do nome ou
endereço do servidor. É recomendável
também
usar adicionalmente o parâmetro <span style="font-family: monospace; 
font-weight: bold;">iburst</span>

no comando, que serve para acelerar a
sincronização inicial.<br><br>Um
cliente pode criar associações com vários
servidores simultaneamente (na verdade é recomendável que
seja assim), e um servidor pode fornecer tempo a diversos clientes
simultaneamente.<br><br>Um dispositivo (<span style="font-style: 
italic;">host</span>) NTP normalmente é cliente e servidor ao mesmo 
tempo.<br>
<br style="font-weight: bold;">
</li>
<li><span style="font-weight: bold;">Modo
simétrico: </span><span style="font-style: italic;">(symmetric
mode)</span> Dois ou mais dispositivos NTP podem ser configurados
como pares <span style="font-style: italic;">(peers)</span>,
de forma que possam tanto buscar o tempo, quanto fornecê-lo,
garantindo redundância mútua. Essa
configuração faz sentido para dispositivos no
mesmo
estrato, configurados também como clientes de um ou mais
servidores. Caso um dos pares perca a referência de seus
servidores, os demais pares podem funcionar como referência
de
tempo.<br>

<br>
O modo simétrico pode ser:<br>
<br>

<ul>
<li><span style="font-weight: bold;">Ativo:</span>
O dispositivo A configura o dispositivo B como seu par (criando dessa
forma uma associação permanente). Por sua vez, o
dispositivo B também configura o dispositivo A como seu par
(também cria uma associação
permanente).<br>
<br>
</li>

<li><span style="font-weight: bold;">Passivo:</span>
O dispositivo A configura o dispositivo B como seu par (modo
simétrico ativo). Mas o dispositivo B <span style="text-decoration: 
underline;">não</span>
tem o dispositivo A na sua lista de servidores ou pares. Ainda assim,
ao receber um pacote de A, o dispositivo B cria uma
associação transitória, de forma a
poder fornecer
ou receber o tempo de A.<br>
<br>
Esse modo é particularmente
susceptível a ataques, onde um dispositivo intruso pode
estar
configurado no modo simétrico ativo e fornecer
informações de tempo falsas para outro. Por isso
deve
sempre ser usado com criptografia.</li>
</ul>
</li></ul>
<div style="margin-left: 40px;">Para
configurar um dispositivo no modo simétrico utiliza-se o
parâmetro <span style="font-family: monospace; font-weight: bold;">peer</span>,
seguido do nome ou IP do par. Com o modo simétrico
não deve-se utilizar os parâmetros <span style="font-family: monospace; 
font-weight: bold;">burst</span>
ou <span style="font-family: monospace; font-weight: bold;">iburst</span>.
<br>
<br>

Para evitar a falha de segurança descrita no modo
simétrico passivo, <span style="font-weight: bold;">deve-se
sempre manter a autenticação habilitada</span>.
Isso é o padrão do sistema. Para desabilitar a
autenticação&nbsp;inclui-se o
parâmetro <span style="font-family: monospace; font-weight: bold;">disable
auth</span> no arquivo de configuração: <span style="color: rgb(153, 0, 
0);">isso não deve ser
feito</span>, a menos que se entenda muito bem as
conseqüências e haja uma razão muito
forte. </div>

<ul>
<li><span style="font-weight: bold; font-style: italic;">Broadcast</span><span
 style="font-style: italic;"> </span>ou<span style="font-style: italic;">
 </span><span style="font-weight: bold; font-style: italic;">Multicast: </span><span
 style="font-weight: bold;"></span>O NTP pode fazer uso
de pacotes do tipo <span style="font-style: italic;">broadcast
</span>ou<span style="font-style: italic;">
multicast </span>para enviar ou receber
informações de tempo. Esse tipo de
configuração pode ser vantajosa no caso de redes
locais com poucos servidores alimentando uma grande quantidade de 
clientes.<br>
<br>
O cliente NTP no modo <span style="font-style: italic;">broadcast

</span>ou<span style="font-style: italic;">
multicast </span>(à partir da versão 4),
ao receber o primeiro pacote de um servidor,&nbsp;busca os dados
por um curto período de tempo, como se estivesse no modo
cliente - servidor, a fim de conhecer o atraso envolvido. Ou seja,
durante alguns instantes há troca de pacotes entre cliente e
servidor, depois disso o cliente passa apenas a receber os pacotes <span
 style="font-style: italic;">broadcast </span>ou<span style="font-style:
 italic;"> multicast</span> do
servidor.&nbsp;<br>

<br>
Para configurar um servidor utiliza-se o parâmetro <span 
style="font-family: monospace; font-weight: bold;">broadcast</span>,
seguido do endereço IP de <span style="font-style: italic;">broadcast </span>da
interface
 de rede, ou de um endereço <span style="font-style: italic;">multicast</span>.
 O IANA
reservou os endereços multicast&nbsp;224.0.1.1 (IPv4)
e&nbsp;ff05::101 (IPv6 - site local) para o NTP, mas outros
endereços podem ser utilizados.
O&nbsp;parâmetro <span style="font-family: monospace; font-weight: 
bold;">minpoll </span>controla
o tempo entre pacotes e o parâmetro&nbsp;<span style="font-family: 
monospace; font-weight: bold;">ttl&nbsp;</span>o
número de saltos máximo de cada um deles.<br>

<br>
Para configurar o cliente utiliza-se o parâmetro <span 
style="font-family: monospace; font-weight: bold;">broadcastclient</span>.
 Na versão 3 do NTP era necessário
também utilizar o parâmetro&nbsp;<span style="font-family: monospace; 
font-weight: bold;">broadcastdelay</span>
para definir o atraso de rede envolvido.<br>
<br>
Como no caso do modo simétrico passivo, há aqui
uma questão de segurança, porque um intruso pode
facilmente enviar pacotes NTP falsos em modo <span style="font-style: 
italic;">broadcast</span>.
Então <span style="font-weight: bold;">a
autenticação deve sempre estar habilitada</span>.
Isso é o padrão do sistema. Para desabilitar a
autenticação&nbsp;inclui-se o
parâmetro <span style="font-family: monospace; font-weight: bold;">disable
auth</span> no arquivo de configuração: <span style="color: rgb(153, 0, 
0);">isso não deve ser
feito</span>, a menos que se entenda muito bem as
conseqüências e haja uma razão muito
forte.</li>
</ul>
Ao consultar-se a lista de servidores no&nbsp;NTP, o tipo de conexão (<span
 style="font-style: italic;">t</span>) é informada. Pode ser&nbsp;<span 
style="font-style: italic;">local, unicast, multicast</span> ou <span 
style="font-style: italic;">broadcast</span>, no exemplo abaixo todas as
 conexões são <span style="font-style: italic;">unicast</span>:<br><br>

<span style="font-family: monospace; color: rgb(0, 51, 0);">usuario@cliente.local:~$
<span style="font-weight: bold;">ntpq
-c pe</span></span><br style="font-family: monospace;"><span 
style="font-family: monospace;"><span style="font-weight: bold;"></span></span><span
 style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;
remote&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
refid&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; st <span style="font-weight: bold;">t</span>
 when poll reach&nbsp;&nbsp; delay&nbsp;&nbsp; offset&nbsp; jitter</span><br
 style="color: black;"><span style="font-family: monospace; color: 
black;">==============================================================================</span><br
 style="color: black;"><span style="font-family: monospace; color: 
black;">-servidor1 &nbsp; &nbsp; &nbsp; 
.IRIG.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 <span
 style="font-weight: bold;">u</span>&nbsp;&nbsp;&nbsp; 8&nbsp;&nbsp; 
32&nbsp; 377&nbsp;&nbsp;&nbsp; 0.407&nbsp;&nbsp;&nbsp; 0.248&nbsp;&nbsp;
 0.016</span><br style="color: black;"><span style="font-family: 
monospace; color: black;">-servidor2 &nbsp; &nbsp; &nbsp; 
.GPS.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1
 <span style="font-weight: bold;">u</span>&nbsp;&nbsp;&nbsp; 
-&nbsp;&nbsp; 32&nbsp; 377&nbsp;&nbsp;&nbsp; 0.474&nbsp;&nbsp;&nbsp; 
0.213&nbsp;&nbsp; 0.019</span><br style="color: black;"><span 
style="font-family: monospace; color: black;">+servidor3 &nbsp; &nbsp; 
&nbsp; 
.GPS.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1
 <span style="font-weight: bold;">u</span>&nbsp;&nbsp;&nbsp; 
9&nbsp;&nbsp; 64&nbsp; 377&nbsp;&nbsp; 15.680&nbsp;&nbsp; 
-0.005&nbsp;&nbsp; 0.026</span><br style="color: black;"><span 
style="font-family: monospace; color: black;">+servidor4 &nbsp; &nbsp; 
&nbsp; 
.IRIG.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 <span
 style="font-weight: bold;">u</span>&nbsp;&nbsp; 30&nbsp;&nbsp; 64&nbsp;
 377&nbsp;&nbsp; 15.582&nbsp;&nbsp;&nbsp; 0.004&nbsp;&nbsp; 0.100</span><br
 style="color: black;"><span style="font-family: monospace; color: 
black;">*servidor5&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; 
.GPS.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1
 <span style="font-weight: bold;">u</span>&nbsp;&nbsp; 10&nbsp;&nbsp; 
32&nbsp; 377&nbsp;&nbsp;&nbsp; 0.400&nbsp;&nbsp; -0.026&nbsp;&nbsp; 
0.049</span><br style="color: black;"><span style="font-family: 
monospace; color: black;">xservidor6 &nbsp; &nbsp; &nbsp; 
.IRIG.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 <span
 style="font-weight: bold;">u</span>&nbsp;&nbsp; 26&nbsp;&nbsp; 64&nbsp;
 377&nbsp;&nbsp;&nbsp; 7.824&nbsp;&nbsp;&nbsp; 9.923&nbsp;&nbsp; 0.367</span>



<p class="voltar-top"><a href="#inicio" name="Funcionamento">Voltar</a></p>


<span class="titulo">O Funcionamento do NTP</span><br>
<br>Como
já visto, NTP é um protocolo
de rede que permite a sincronização dos
relógios dos
dispositivos à partir de
referências de tempo confiáveis. Num primeiro momento isso
pode parecer algo tão simples quanto "consultar o tempo em um
servidor" e "ajustar o relógio local" de tempos em tempos. Na
verdade, algumas implementações do SNTP, a versão
simplificada do protocolo, fazem isso e apenas isso. Mas o NTP em sua
forma completa é muito mais complexo.<br><br>Diversos componentes do 
sistema colaboram para:<br><ul><li>Obter,

à partir de diversas amostras, informações de
tempo de um determinado servidor, como o deslocamento, dispersão
e variação.<br><br></li><li>Discernir, dentre um conjunto de servidores,
 quais fornecem o tempo correto e quais estão mentindo.<br><br></li><li>Escolher,
 dentre os servidores que fornecem o tempo correto, qual é a melhor 
referência.<br><br></li><li>Disciplinar
o relógio local, descobrindo seus principais parâmetros de
funcionamento, como precisão, estabilidade e escorregamento
e&nbsp;ajustando-o de forma contínua e gradual, mesmo na
ausência temporária de referências de tempo
confiáveis, para que tenha e melhor exatidão
possível.<br><br></li><li>Garantir a monotonicidade do tempo.<br><br></li><li>Identificar,

à
 partir de métodos criptográficos, servidores de
tempo conhecidos e confiáveis, evitando possíveis ataques.<br><br></li><li>Formar,
em
 conjunto com outros servidores NTP, uma topologia simples,
confiável, robusta e escalável para a
sincronização de tempo.</li></ul><br>
<div style="text-align: center;"><img src="ntp_arquivos/ntp-alg1.gif" 
alt="ntp-alg1.gif"><br></div><div style="text-align: center;"><small 
style="font-weight: bold;">Figura 2: O funcionamento do NTP <sup>(1)</sup></small><br></div>
<br>A <span style="font-weight: bold;">Figura 2</span> mostra os
principais componentes do NTP, que são apresentados e explicados
de uma forma bastante simplificada no texto a seguir. Para
informações mais precisas
sobre como são calculadas as várias métricas do
sistema e sobre como devem funcionar os diversos algorítmos,
recomenda-se a consulta direta às RFCs e à

documentação oficial.


<p class="voltar-top"><a href="#inicio" name="Mensagens">Voltar</a></p>




<span class="titulo">Troca de Mensagens e
Cálculo do Deslocamento</span><br>
<br>As
mensagens do NTP são baseadas no protocolo UDP, que é um
protocolo não confiável e não orientado à
conexão.<br><br>A troca de mensagens entre cliente e servidor permite 
que o cliente descubra qual seu deslocamento (<span style="font-style: 
italic;">offset</span>) em relação ao servidor, ou seja, o quanto seu 
relógio local difere do relógio do servidor.<br><br>Consideremos 
servidor e cliente com relógios não sincronizados. A troca de mensagens,
 ilustrada na <span style="font-weight: bold;">Figura 3</span>, dá-se da
 seguinte forma:<br><ol><li>O <span style="font-weight: bold;">Cliente</span>
 lê seu relógio, que fornece o tempo <span style="font-weight: bold;">a</span>.</li><li>O
 <span style="font-weight: bold;">Cliente</span> envia&nbsp;a <span 
style="font-weight: bold;">Mensagem 1</span> com a informação de tempo <span
 style="font-weight: bold;">a</span> para o servidor.</li><li>O <span 
style="font-weight: bold;">Servidor</span> recebe a <span 
style="font-weight: bold;">Mensagem 1 </span>e nesse instante lê seu 
relógio, que fornece o instante <span style="font-weight: bold;">x</span>.
 O <span style="font-weight: bold;">Servidor</span> mantém <span 
style="font-weight: bold;">a</span> e <span style="font-weight: bold;">x</span>
 em variáveis.</li><li>O <span style="font-weight: bold;">Servidor</span>
 após algum tempo lê novamente seu relógio, que fornece o instante <span
 style="font-weight: bold;">y</span>.</li><li>O <span 
style="font-weight: bold;">Servidor</span> envia a <span 
style="font-weight: bold;">Mensagem 2</span> com <span 
style="font-weight: bold;">a</span>, <span style="font-weight: bold;">x</span>
 e <span style="font-weight: bold;">y</span> para o cliente.</li><li>O <span
 style="font-weight: bold;">Cliente</span> recebe a <span 
style="font-weight: bold;">Mensagem 2</span> e nesse instante lê seu 
relógio, que fornece o instante <span style="font-weight: bold;">b</span>.</li></ol><span
 style="font-weight: bold;"><br></span>

<div style="text-align: center;"><img 
src="ntp_arquivos/ntp-mensagens1.gif" alt="ntp-mensagens1.gif"><br>
</div><div style="text-align: left;"><div style="text-align: center;"><small
 style="font-weight: bold;">Figura 3: Troca de mensagens <sup>(1)</sup></small><br></div><br>Ao
 receber a <span style="font-weight: bold;">Mensagem 2</span>, o <span 
style="font-weight: bold;">Cliente</span> passa a conhecer os instantes <span
 style="font-weight: bold;">a</span>, <span style="font-weight: bold;">x</span>,
 <span style="font-weight: bold;">y</span> e <strong style="font-weight:
 bold;">b</strong>. Mas <span style="font-weight: bold;">a</span> e <span
 style="font-weight: bold;">b</span> estão numa escala de tempo, 
enquanto <span style="font-weight: bold;">x</span> e <span 
style="font-weight: bold;">y</span> em outra. O valor do incremento 
dessas escalas é o mesmo, mas os relógios não estão sincronizados.<br><br>Não
 é possível, então, calcular o tempo que a <span style="font-weight: 
bold;">Mensagem 1</span> levou para ser transmitida (<span 
style="font-weight: bold;">T-ida</span>), nem o tempo que a <span 
style="font-weight: bold;">Mensagem 2</span> gastou na rede (<span 
style="font-weight: bold;">T-volta</span>). Contudo, o <span 
style="font-weight: bold;">tempo total</span> de ida e volta, ou <span 
style="font-weight: bold;">atraso</span> (também conhecido por <span 
style="font-style: italic; font-weight: bold;">Round Trip Time</span> ou
 <span style="font-style: italic; font-weight: bold;">RTT</span>) que é a
 soma <span style="font-weight: bold;">T-ida + T-volta </span>pode ser 
calculado como:<br><br><div style="margin-left: 40px;"><span 
style="font-weight: bold;">atraso (</span><span style="font-style: 
italic; font-weight: bold;">delay</span><span style="font-weight: bold;">)
 =&nbsp; (b-a)-(y-x).</span><br></div><br>Considerando-se
que o tempo de ida é igual ao tempo de volta, pode-se calcular o
deslocamento entre o servidor e o relógio local como como:<br><br><div 
style="margin-left: 40px;"><span style="font-weight: bold;">deslocamento
 (<span style="font-style: italic;">offset</span>) = x - (a + atraso/2) =
 </span><br><span style="font-weight: bold;">deslocamento (<span 
style="font-style: italic;">offset</span>) = (x-a+y-b)/2.</span><br></div><br><br>Para
 facilitar a compreensão, considere-se o seguinte exemplo numérico.<br><ol><li>O
 <span style="font-weight: bold;">Cliente</span> lê o relógio: <span 
style="font-weight: bold;">a=9</span>.</li><li>O <span 
style="font-weight: bold;">Cliente</span> envia a <span 
style="font-weight: bold;">Mensagem 1 (a=9)</span>.</li><li>O <span 
style="font-weight: bold;">Servidor</span> recebe a <span 
style="font-weight: bold;">Mensagem 1 (a=9)</span> e lê seu relógio: <span
 style="font-weight: bold;">x=4</span>.</li><li>O <span 
style="font-weight: bold;">Servidor</span> algum tempo depois lê seu 
relógio novamente: <span style="font-weight: bold;">y=9</span>.</li><li>O
 <span style="font-weight: bold;">Servidor</span> envia a <span 
style="font-weight: bold;">Mensagem 2 (a=9, x=4, y=9)</span>.</li><li>O <span
 style="font-weight: bold;">Cliente</span> recebe a <span 
style="font-weight: bold;">Mensagem 2 (a=9, x=4, y=9)</span> e lê seu 
relógio: <span style="font-weight: bold;">b=18</span>.</li></ol><br></div><br><img
 src="ntp_arquivos/ntp-mensagens2.gif" alt="ntp-mensagens2.gif"><br><div
 style="text-align: center;"><small style="font-weight: bold;">Figura 4:
 Troca de mensagens - exemplo <sup>(1)</sup></small><br></div>


<br>Ao olhar a <span style="font-weight: bold;">Figura 4</span>, é 
fácil&nbsp;observar que <span style="font-weight: bold;">T-ida=2</span> e
 <span style="font-weight: bold;">T-volta=2</span>. Contudo, nem o <span
 style="font-weight: bold;">Cliente</span> nem o <span 
style="font-weight: bold;">Servidor</span> têm essa visão. O <span 
style="font-weight: bold;">Servidor</span> ao final da troca de 
mensagens descarta todas as informações sobre a mesma. O <span 
style="font-weight: bold;">Cliente</span> conhece as variáveis <span 
style="font-weight: bold;">a=9, x=4, y=9 e</span> <span 
style="font-weight: bold;">b=18</span>, mas à partir delas é impossível 
calcular <span style="font-weight: bold;">T-ida</span> ou <span 
style="font-weight: bold;">T-volta</span>. Contudo, é possível calcular o
 atraso e o deslocamento:<br><br><div style="margin-left: 40px;"><span 
style="font-weight: bold;">atraso = (b-a)-(y-x) = (18-9)-(9-4) = 9 - 5 =
 4.</span><br><span style="font-weight: bold;"></span></div><span 
style="font-weight: bold;"><br></span><div style="margin-left: 40px;"><span
 style="font-weight: bold;">deslocamento = (x-a+y-b)/2 = (4-9+9-18)/2 = 
-14/2 = -7.</span><br><span style="font-weight: bold;"></span></div><br>Um
 deslocamento de <span style="font-weight: bold;">-7</span> significa 
que o relógio local do <span style="font-weight: bold;">Cliente</span> 
deve ser <span style="font-weight: bold;">atrasado 7 unidades de tempo</span>
 para se igualar ao do <span style="font-weight: bold;">Servidor</span>.<br><br>Note-se
 que foi assumido alguns parágrafos acima, para se conseguir calcular o 
deslocamento,&nbsp;que <span style="font-weight: bold;">T-ida = T-volta</span>.
 Mas <span style="font-weight: bold;">isso nem sempre é verdade!</span>

Há atrasos estocásticos nas redes devido às filas
dos roteadores e switchs. Numa WAN ou na Internet enlaces de diferentes
velocidades e roteamento assimétrico, além de outros
fatores, também causam diferenças entre <span style="font-weight: bold;">T-ida</span>
 e <span style="font-weight: bold;">T-volta</span>. &nbsp; <br><br>No 
entanto o NTP funciona exatamente dessa forma, considerando que T-ida = 
T-volta.<br><br>Isso implica num erro. Esse erro, representado na <span 
style="font-weight: bold;">Figura 5</span>, é no pior caso igual à 
metade do atraso. Ou seja:<br><br><div style="margin-left: 40px;"><span 
style="font-weight: bold;">deslocamento - atraso/2 &lt;= deslocamento 
verdadeiro &lt;= deslocamento + atraso/2</span><br></div><div 
style="text-align: center;"><br><img 
src="ntp_arquivos/ntp-errodesloc.png" alt="ntp-errodesloc.png"><br></div><div
 style="text-align: center;"><small style="font-weight: bold;"><br>Figura
 5: Erro do deslocamento por causa da assimetria</small><br></div><br><br>Tome-se
 o seguinte exemplo numérico, ilustrando o pior caso. Os servidores são 
os mesmos da <span style="font-weight: bold;">Figura 4</span>, mas a 
primeira mensagem leva um tempo desprezível pra ser enviada, enquanto a 
segunda demora 4 unidades de tempo:<span style="font-weight: bold;"> 
a=9; x=2; y=7; b=18.&nbsp; </span>Nesse caso <span style="font-weight: 
bold;">T-ida=0</span> e <span style="font-weight: bold;">T-volta=4. </span>O
 exemplo está ilustrado na <span style="font-weight: bold;">Figura 6</span>.<div
 style="text-align: center;"><img src="ntp_arquivos/ntp-mensagens3.gif" 
alt="ntp-mensagens3.gif"><br><small style="font-weight: bold;">Figura 6:
 Troca de mensagens - assimetria <sup>(1)</sup></small><br></div>Calcula-se
 o atraso como: <br><br><div style="margin-left: 40px;"><span 
style="font-weight: bold;">atraso = (b-a)-(y-x) = (18-9)-(7-2) = 9 - 5 =
 4.<br><br></span><span style="font-weight: bold;"></span></div><div 
style="margin-left: 40px;"><span style="font-weight: bold;"></span><span
 style="font-weight: bold;"></span><span style="font-weight: bold;">deslocamento
 = (x-a+y-b)/2 = (2-9+7-18)/2 = -18/2 = -9.</span><br></div><br>O
deslocamento está errado! Sabe-se que o valor correto é

-7, contudo o valor calculado é -9. Isso deve-se a assimetria da
rede, no tocante a T-ida e T-volta.<br><br>No entanto, à partir
do cálculo do deslocamento e do atraso, e levando em conta a
limitação do método, que considera T-ida=T-volta,
sabe-se que o deslocamente verdadeiro está entre:<span 
style="font-weight: bold;"><br><br></span><div style="margin-left: 
40px;">deslocamento - 2 &lt;= deslocamento verdadeiro &lt;= deslocamento
 + 2<br><br>-9 -2 &lt;= deslocamento verdadeiro &lt;= -9 + 2<br><br>-11 
&lt;= deslocamento verdadeiro &lt;= -7</div><br>Ou
seja, dado um deslocamento de -9 e um atraso de 4, sabe-se que o valor
verdadeiro do deslocamento é algo entre -11 e -7, mas não
há como ter certeza de qual o valor. Como nesse exemplo o valor
correto é conhecido de antemão,&nbsp;-7, pode-se
verificar que o cálculo funciona adequadamente.


<p class="voltar-top"><a href="#inicio" name="Filtro">Voltar</a></p>





<span class="titulo">O Algorítmo de Filtro
de Relógio</span><br>
<br>



Através
da troca de mensagens, o NTP consegue as informações de
atraso e deslocamento de um servidor. Essa troca de mensagens
não é realizada uma única vez. Ela se repete
periodicamente, com o período dinamicamente controlado pelo NTP.<br><br>No
início
 da sincronização o cliente NTP faz uma
consulta a cada servidor a cada 64s. Esse período varia ao longo
do tempo, geralmente aumenta, até chegar a 1024s
(aproximadamente 17min). As variáveis <span style="font-family: 
monospace; font-weight: bold;">minpoll </span>e <span 
style="font-family: monospace; font-weight: bold;">maxpoll </span>definem
 o mínimo e o máximo, e são representadas em potência de 2. Ou seja, por
 padrão <span style="font-family: monospace; font-weight: bold;">minpoll=6&nbsp;</span>(2<small><small><sup>6</sup></small></small>=64)e
 <span style="font-family: monospace; font-weight: bold;">maxpoll=10 </span><span
 style="font-family: monospace; font-weight: bold;"></span>(2<small><small><sup>10</sup></small></small>=1024).
 Numa consulta à lista de servidores NTP, a variável&nbsp;<span 
style="font-family: monospace; font-weight: bold;">poll </span>representa
 o período e a variável <span style="font-family: monospace; 
font-weight: bold;">when </span>é um contador que indica quantos 
segundos se passaram desde a última consulta; quando <span 
style="font-family: monospace; font-weight: bold;">poll = </span><span 
style="font-family: monospace; font-weight: bold;">when</span> uma nova 
consulta é realizada e a variável <span style="font-family: monospace; 
font-weight: bold;">when </span>é zerada. Se o parâmetro&nbsp;<span 
style="font-family: monospace; font-weight: bold;">iburst </span>é

utilizado na configuração de um servidor, a taxa de envio
de pacotes é acelerada no início da
sincronização, de forma a se conseguir um conjunto de
dados mais depressa. A variável&nbsp;<span style="font-family: 
monospace; font-weight: bold;">reach</span>
representa um registrador de deslocamento de 8 bits, cujo valor
é mostrado no formato octal. Um bit 1 significa que o cliente
obteve resposta do servidor para uma consulta. Então o valor 377
= 11.111.111, significa que as últimas 8 consultas ao servidor
foram bem sucedidas.<br><br><div style="margin-left: 40px;"><span 
style="font-family: monospace; color: rgb(0, 51, 0);">usuario@servidor:~$
<span style="font-weight: bold;">ntpq
-c pe</span></span><br style="font-family: monospace;"><span 
style="font-family: monospace;">remote

&nbsp; &nbsp; refid &nbsp;st t <span style="font-weight: bold;">when 
poll</span> <span style="font-weight: bold;">reach</span> delay 
&nbsp;offset<span style="font-weight: bold;"> </span>jitter</span><br 
style="font-family: monospace;"><span style="font-family: monospace;">==============================================================================</span><br
 style="font-family: monospace;"><span style="font-family: monospace;">*servidor1
.IRIG.
 1 &nbsp;u <span style="font-weight: bold;">93 &nbsp; 128</span> &nbsp;<span
 style="font-weight: bold;">377</span> &nbsp; 0.523

&nbsp;<span style="color: black;">0.020</span>
&nbsp;0.033</span><br style="font-family: monospace;"><span 
style="font-family: monospace;">+servidor2
.GPS. &nbsp;1 &nbsp;u <span style="font-weight: bold;">57 
&nbsp;&nbsp;128</span> &nbsp;<span style="font-weight: bold;">377</span>
&nbsp; 0.488 -0.054
&nbsp;0.025</span><br style="font-family: monospace;"><span 
style="font-family: monospace;">-servidor3
.IRIG. 1 &nbsp;u <span style="font-weight: bold;">50 &nbsp; 128</span> 
&nbsp;<span style="font-weight: bold;">377 </span>&nbsp; 5.151 -0.386

&nbsp;0.382</span><br style="font-family: monospace;"><span 
style="font-family: monospace;">+servidor4
.IRIG. 1 &nbsp;u&nbsp;<span style="font-weight: bold;">34 &nbsp; 
&nbsp;64</span> &nbsp;<span style="font-weight: bold;">377</span> &nbsp;
 5.163 -0.360
&nbsp;0.559</span><br></div>




<br><br><img style="width: 400px; height: 547px; float: right;" 
src="ntp_arquivos/ntp-filtro.gif" alt="ntp-filtro.gif" hspace="10">É
importante notar então, que não há apenas um valor
de atraso e um de deslocamento para cada servidor, mas um conjunto
deles, provenientes das diversas trocas de mensagem! A partir dessa
lista de valores,&nbsp;o <span style="font-weight: bold;">Algorítmo de 
Filtro de Relógio</span> calcula então um valor de atraso (<span 
style="font-style: italic;">delay</span>), de deslocamento (<span 
style="font-style: italic;">offset</span>) e de variação (<span 
style="font-style: italic;">jitter</span>).<br><br>Na
verdade, cada amostra é composta de 4 valores: atraso,
deslocamento, dispersão e estampa de tempo. A estampa de tempo
indica quando a amostra chegou. A dispersão é o erro
estimado do relógio de servidor remoto, informada pelo servidor
na mensagem NTP.<br><br>A lista com os valores é ordenada em
função do atraso. Considera-se que as amostras com menor
atraso são melhores porque provavelmente não se
sujeitaram a filas nos <span style="font-style: italic;">switches</span>

e roteadores, de forma que parte das variações
estocásticas de tempo no envio e recebimento das mensagens
é evitada com essa escolha.<br><br>Os valores mais antigos
são descartados, porque o valor de deslocamento pode não
mais corresponder à realidade, já que a exatidão
do relógio local&nbsp;varia ao longo do tempo. <br><br>Após
descartar as amostras antigas, resta uma lista com as amostras mais
recentes e ordenadas em função do atraso. Da primeira
entrada dessa lista são&nbsp;retiradas as variáveis
atraso e deslocamento para o par cliente servidor (note-se que para
cada par cliente - servidor há uma variável de cada tipo).<br><br>A 
dispersão e a variação são calculadas levando em conta todos os valores 
da lista.<br><br>A <span style="font-weight: bold;">Figura 7</span> 
ilustra o funcionamento desse algorítmo.<br><br>Os valores para cada 
servidor associado podem ser consultados no NTP como segue:<br><br><span
 style="font-family: monospace; color: rgb(0, 51, 0);">usuario@cliente.local:~$

<span style="font-weight: bold;">ntpq&nbsp;</span></span><br 
style="font-family: monospace;"><span style="font-family: monospace;"><span
 style="font-weight: bold;">ntpq&gt; pe</span></span><br><span 
style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;
remote&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
refid&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; st t when poll reach&nbsp;&nbsp; <span
 style="font-weight: bold;">delay&nbsp;&nbsp; offset&nbsp; jitter</span></span><br><span
 style="font-family: monospace;">==============================================================================</span><br><span
 style="font-family: monospace;">-servidor1

&nbsp; &nbsp; &nbsp;
.IRIG.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1
u&nbsp;&nbsp;&nbsp; 8&nbsp;&nbsp; 32&nbsp; 377&nbsp;&nbsp;&nbsp; <span 
style="font-weight: bold; color: rgb(153, 0, 0);">0.407&nbsp;&nbsp;&nbsp;
 0.248&nbsp;&nbsp; 0.016</span></span><br><span style="font-family: 
monospace;">-servidor2

&nbsp; &nbsp; &nbsp;
.GPS.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
1 u&nbsp;&nbsp;&nbsp; -&nbsp;&nbsp; 32&nbsp; 377&nbsp;&nbsp;&nbsp; <span
 style="font-weight: bold;">0.474&nbsp;&nbsp;&nbsp; 0.213&nbsp;&nbsp; 
0.019</span></span><br><span style="font-family: monospace;">+servidor3

&nbsp; &nbsp; &nbsp;
.GPS.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
1 u&nbsp;&nbsp;&nbsp; 9&nbsp;&nbsp; 64&nbsp; 377&nbsp;&nbsp; <span 
style="font-weight: bold;">15.680&nbsp;&nbsp; -0.005&nbsp;&nbsp; 0.026</span></span><br><span
 style="font-family: monospace;">+servidor4

&nbsp; &nbsp; &nbsp;
.IRIG.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1
u&nbsp;&nbsp; 30&nbsp;&nbsp; 64&nbsp; 377&nbsp;&nbsp; <span 
style="font-weight: bold;">15.582&nbsp;&nbsp;&nbsp; 0.004&nbsp;&nbsp; 
0.100</span></span><br><span style="font-family: monospace;">*servidor5&nbsp;

&nbsp;&nbsp;&nbsp;&nbsp;
.GPS.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
1
 u&nbsp;&nbsp; 10&nbsp;&nbsp; 32&nbsp; 377&nbsp;&nbsp;&nbsp; <span 
style="font-weight: bold;">0.400&nbsp;&nbsp; -0.026&nbsp;&nbsp; 0.049</span></span><br><span
 style="font-family: monospace;">xservidor6

&nbsp; &nbsp; &nbsp;
.IRIG.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1
u&nbsp;&nbsp; 26&nbsp;&nbsp; 64&nbsp; 377&nbsp;&nbsp;&nbsp; <span 
style="font-weight: bold;">7.824&nbsp;&nbsp;&nbsp; 9.923&nbsp;&nbsp; 
0.367</span></span><br><span style="font-family: monospace;">&nbsp;servidor7

&nbsp;
 &nbsp; &nbsp;
.INIT.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 16
u&nbsp;&nbsp;&nbsp; - 1024&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp; <span 
style="font-weight: bold;">0.000&nbsp;&nbsp;&nbsp; 0.000 4000.00</span></span><br><span
 style="font-family: monospace;">-servidor8
&nbsp; &nbsp; &nbsp;

.ACTS.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1
u&nbsp;&nbsp; 13&nbsp;&nbsp; 64&nbsp; 377&nbsp; <span 
style="font-weight: bold;">202.274&nbsp;&nbsp;&nbsp; 2.459&nbsp;&nbsp; 
0.309</span></span><br><span style="font-family: monospace;">&nbsp;LOCAL(0)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

LOCAL(0)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 13 l&nbsp;&nbsp;
48&nbsp;&nbsp; 64&nbsp; 377&nbsp;&nbsp;&nbsp; <span style="font-weight: 
bold;">0.000&nbsp;&nbsp;&nbsp; 0.000&nbsp;&nbsp; 0.001</span></span><br><span
 style="font-family: monospace;"></span><br><span style="font-family: 
monospace;"></span>Detalhando os valores para o primeiro (&amp;1) 
servidor da lista:<br><span style="font-family: monospace; color: rgb(0,
 51, 0);"><span style="font-weight: bold;"></span></span><br><span 
style="font-family: monospace;"><span style="font-weight: bold;">ntpq&gt;
 rv &amp;1</span></span><br><span style="font-family: monospace;">assID=47012
 status=9314 reach, conf, sel_outlyer, 1 event, event_reach,</span><br><span
 style="font-family: monospace;">srcadr=servidor1, srcport=123, 
dstadr=cliente.local, dstport=123,</span><br><span style="font-family: 
monospace;">leap=00, stratum=1, precision=-19, rootdelay=0.000,</span><br><span
 style="font-family: monospace;">rootdispersion=0.351, refid=IRIG, 
reach=377, unreach=0, hmode=3,</span><br><span style="font-family: 
monospace;">pmode=4, hpoll=5, ppoll=5, flash=00 ok, keyid=0, ttl=0, <span
 style="font-weight: bold; color: rgb(153, 0, 0);">offset=0.248</span>,</span><br><span
 style="font-family: monospace;"><span style="color: rgb(153, 0, 0); 
font-weight: bold;">delay=0.407, dispersion=0.059, jitter=0.016,</span></span><br><span
 style="font-family: monospace;">reftime=cacb6721.f903866e&nbsp; Thu, 
Oct 25 2007 17:04:01.972,</span><br><span style="font-family: 
monospace;">org=cacb6729.1e5c8d02&nbsp; Thu, Oct 25 2007 17:04:09.118,</span><br><span
 style="font-family: monospace;">rec=cacb6729.1e5a1448&nbsp; Thu, Oct 25
 2007 17:04:09.118,</span><br><span style="font-family: monospace;">xmt=cacb6729.1e393ee5&nbsp;
 Thu, Oct 25 2007 17:04:09.118,</span><br><span style="font-family: 
monospace;">filtdelay=&nbsp;&nbsp;&nbsp;&nbsp;

0.44&nbsp;&nbsp;&nbsp; 0.41&nbsp;&nbsp;&nbsp; 0.56&nbsp;&nbsp;&nbsp;
0.56&nbsp;&nbsp;&nbsp; 0.58&nbsp;&nbsp;&nbsp; 0.54&nbsp;&nbsp;&nbsp;
0.58&nbsp;&nbsp;&nbsp; 0.53,</span><br><span style="font-family: 
monospace;">filtoffset=&nbsp;&nbsp;&nbsp;

0.26&nbsp;&nbsp;&nbsp; 0.25&nbsp;&nbsp;&nbsp; 0.23&nbsp;&nbsp;&nbsp;
0.27&nbsp;&nbsp;&nbsp; 0.26&nbsp;&nbsp;&nbsp; 0.22&nbsp;&nbsp;&nbsp;
0.24&nbsp;&nbsp;&nbsp; 0.25,</span><br><span style="font-family: 
monospace;">filtdisp=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

0.00&nbsp;&nbsp;&nbsp; 0.03&nbsp;&nbsp;&nbsp; 0.06&nbsp;&nbsp;&nbsp;
0.09&nbsp;&nbsp;&nbsp; 0.12&nbsp;&nbsp;&nbsp; 0.15&nbsp;&nbsp;&nbsp;
0.18&nbsp;&nbsp;&nbsp; 0.21</span>


<p class="voltar-top"><a href="#inicio" name="Selecao">Voltar</a></p>





<span class="titulo">O Algorítimo de
Seleção dos
Relógios</span><br>

<br>Uma vez que o Algorítmo de Filtro de Relógios tenha
calculado os principais parâmetros referentes a cada servidor,
faz-se importante descobrir quais deles são confiáveis e
quais não. Os servidores que têm algum erro no tempo
fornecido são chamados de <span style="font-weight: bold;">relógios 
falsos </span>(<span style="font-style: italic;"></span><span 
style="font-style: italic; font-weight: bold;">falsetickers</span>,
na literatura em inglês, a tradução é

aproximada). Os servidores que fornecem a hora corretamente são
chamados de <span style="font-weight: bold;">relógios verdadeiros</span>
 (<span style="font-style: italic; font-weight: bold;">truechimmers</span>,
 em inglês, uma tradução mais literal seria algo como "badaladores 
verdadeiros").<br><br>Para a seleção dos relógios, o NTP considera como 
verdadeiro o <span style="font-weight: bold;">deslocamento</span> que se
 encontra dentro de um determinado <span style="font-weight: bold;">intervalo
 de confiança</span>, representado na <span style="font-weight: bold;">Figura
 8</span>. Esse intervalo é calculado, para cada associação com um 
servidor, como:<br><br><div style="margin-left: 40px;"><span 
style="font-weight: bold;">intervalo de confiança = (deslocamento/2) + 
dispersão.</span><br style="font-weight: bold;"></div><br><br><div 
style="text-align: center;"><img src="ntp_arquivos/ntp-intervalo.gif" 
alt="ntp-intervalo.gif"><br></div><span style="font-style: italic; 
font-weight: bold;"></span><div style="text-align: center;"><small 
style="font-weight: bold;"><br>Figura 8</small><br></div><br>A <span 
style="font-weight: bold;">Seleção</span>

de relógios busca um intervalo de intersecção para
os valores de deslocamento de cada servidor, considerados os intervalos
de confiança. Os servidores cujos deslocamentos ficam fora da
intersecção são <span style="font-weight: bold;">relógios falsos</span>.
A <span style="font-weight: bold;">Figura 9</span> ilustra isso para 4 
servidores, A, B e C são
relógios verdadeiros, e D é um relógio falso:<br><br><br> <div 
style="text-align: center;"><img src="ntp_arquivos/ntp-selecao.gif" 
alt="ntp-selecao.gif"><br></div><div style="text-align: center;"><small 
style="font-weight: bold;">Figura 9</small><br></div><br>Ao consultar-se
 a lista de servidores do NTP, os relógios falsos são identificados por 
um <span style="font-weight: bold;">"x"</span>. No exemplo abaixo, o 
servidor6 é um <span style="font-weight: bold; color: rgb(153, 0, 0);">relógio
 falso</span> (<span style="color: rgb(51, 51, 51);">esses símbolos, 
como o "x", usados para diferenciar os servidores, são chamados de <span
 style="font-style: italic;">tally-codes</span>, para mais detalhes 
deve-se consultar a seção</span> <a 
href="http://www.ntp.br/utilizando.html">Utilizando</a>.):<br><br><br><span
 style="font-family: monospace; color: rgb(0, 51, 0);">usuario@cliente.local:~$

<span style="font-weight: bold;">ntpq&nbsp;</span></span><br 
style="font-family: monospace;"><span style="font-family: monospace;"><span
 style="font-weight: bold;">ntpq&gt; pe</span></span><br><span 
style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;
remote&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
refid&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; st t when poll reach&nbsp;&nbsp;
delay&nbsp;&nbsp; offset&nbsp; jitter</span><br style="color: black;"><span
 style="font-family: monospace; color: black;">==============================================================================</span><br
 style="color: black;"><span style="font-family: monospace; color: 
black;">-servidor1

&nbsp; &nbsp; &nbsp;
.IRIG.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1
u&nbsp;&nbsp;&nbsp; 8&nbsp;&nbsp; 32&nbsp;
377&nbsp;&nbsp;&nbsp;0.407&nbsp;&nbsp;&nbsp; 0.248&nbsp;&nbsp; 0.016</span><br
 style="color: black;"><span style="font-family: monospace; color: 
black;">-servidor2

&nbsp; &nbsp; &nbsp;
.GPS.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
1 u&nbsp;&nbsp;&nbsp; -&nbsp;&nbsp; 32&nbsp; 
377&nbsp;&nbsp;&nbsp;0.474&nbsp;&nbsp;&nbsp; 0.213&nbsp;&nbsp; 0.019 </span><br
 style="color: black;"><span style="font-family: monospace; color: 
black;">+servidor3

&nbsp; &nbsp; &nbsp;
.GPS.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
1 u&nbsp;&nbsp;&nbsp; 9&nbsp;&nbsp; 64&nbsp; 
377&nbsp;&nbsp;15.680&nbsp;&nbsp; -0.005&nbsp;&nbsp; 0.026 </span><br 
style="color: black;"><span style="font-family: monospace; color: 
black;">+servidor4

&nbsp; &nbsp; &nbsp;
.IRIG.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1
u&nbsp;&nbsp; 30&nbsp;&nbsp; 64&nbsp; 
377&nbsp;&nbsp;15.582&nbsp;&nbsp;&nbsp; 0.004&nbsp;&nbsp; 0.100 </span><br
 style="color: black;"><span style="font-family: monospace; color: 
black;">*servidor5&nbsp;

&nbsp;&nbsp;&nbsp;&nbsp;
.GPS.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
1 u&nbsp;&nbsp; 10&nbsp;&nbsp; 32&nbsp; 
377&nbsp;&nbsp;&nbsp;0.400&nbsp;&nbsp; -0.026&nbsp;&nbsp; 0.049 </span><br
 style="color: black;"><span style="font-family: monospace; color: 
black; font-weight: bold;"><span style="color: rgb(153, 0, 0);">xservidor6
&nbsp;
 &nbsp; &nbsp;

.IRIG.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1
u&nbsp;&nbsp; 26&nbsp;&nbsp; 64&nbsp;
377&nbsp;&nbsp;&nbsp;7.824&nbsp;&nbsp;&nbsp; 9.923&nbsp;&nbsp; 0.367</span></span><br
 style="color: black;"><span style="font-family: monospace; color: 
black;">&nbsp;servidor7
&nbsp; &nbsp; &nbsp;

.INIT.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 16
u&nbsp;&nbsp;&nbsp; - 1024&nbsp;&nbsp;&nbsp; 
0&nbsp;&nbsp;&nbsp;0.000&nbsp;&nbsp;&nbsp; 0.000 4000.00 </span><br 
style="color: black;"><span style="font-family: monospace; color: 
black;">-servidor8
&nbsp; &nbsp; &nbsp;
.ACTS.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1
u&nbsp;&nbsp; 13&nbsp;&nbsp; 64&nbsp; 377&nbsp;202.274&nbsp;&nbsp;&nbsp;
 2.459&nbsp;&nbsp; 0.309 </span><br style="color: black;"><span 
style="font-family: monospace; color: black;">&nbsp;LOCAL(0)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

LOCAL(0)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 13 l&nbsp;&nbsp;
48&nbsp;&nbsp; 64&nbsp; 377&nbsp;&nbsp;&nbsp;0.000&nbsp;&nbsp;&nbsp; 
0.000&nbsp;&nbsp; 0.001 </span>


<p class="voltar-top"><a href="#inicio" name="Agrupamento">Voltar</a></p>



<span class="titulo">O Algorítmo de
Agrupamento</span><br>

<br>O algorítmo de Agrupamento trabalha com os servidores que
são relógios verdadeiros, utilizando técnicas
estatísticas, com o objetivo de selecionar os melhores dentre
eles. Os critérios de seleção utilizados
são:<br><ul><li>estrato (<span style="font-style: italic;">stratum</span>)</li><li>distância
 para a raiz&nbsp;</li><li>variação&nbsp;(<span style="font-style: 
italic;">jitter</span>)</li></ul>No processo alguns servidores são 
descartados, sendo chamados de <span style="font-weight: bold;">relógios
 afastados</span> <span style="font-style: italic;">(outlyers)</span>. 
Os que permanecem são chamados de <span style="font-weight: bold;">relógios
 sobreviventes</span> <span style="font-style: italic;">(survivors)</span>,
 algumas vezes na literatura em inglês utiliza-se candidatos <span 
style="font-style: italic;">(candidates)</span>

no mesmo sentido que sobreviventes, por conta do algorítmo
utilizado onde, à princípio, todos os relógios
verdadeiros são candidatos, mas apenas alguns sobrevivem. <br><br>O 
melhor dos relógios sobreviventes é considerado como <span 
style="font-weight: bold;">par do sistema</span> <span 
style="font-style: italic;">(system peer).<br><br></span>Na
consulta abaixo, o <span style="color: rgb(0, 102, 0); font-weight: 
bold;">par do sistema</span> é indicado pelo <span style="color: rgb(0, 
102, 0);">"</span><span style="font-weight: bold; color: rgb(0, 102, 
0);">*</span><span style="color: rgb(0, 102, 0);">" (em verde)</span>;
os <span style="color: rgb(0, 0, 153); font-weight: bold;">relógios 
sobreviventes</span> por <span style="color: rgb(0, 0, 153);">"</span><span
 style="font-weight: bold; color: rgb(0, 0, 153);">+</span><span 
style="color: rgb(0, 0, 153);">" (em azul)</span>; e os

<span style="font-weight: bold; color: rgb(204, 102, 0);">relógios 
afastados</span> por <span style="color: rgb(204, 102, 0);">"</span><span
 style="font-weight: bold; color: rgb(204, 102, 0);">-</span><span 
style="color: rgb(204, 102, 0);">" (em laranja) </span>(<span 
style="color: rgb(51, 51, 51);">esses símbolos, como o "*", "+" e "-", 
usados
para diferenciar os servidores, são chamados de <span style="font-style:
 italic;">tally-codes</span>, para mais
detalhes deve-se consultar a seção</span> <a 
href="http://www.ntp.br/utilizando.html">Utilizando</a>.):<span 
style="font-style: italic;"><br style="font-style: italic;"></span><br><br><span
 style="font-family: monospace; color: rgb(0, 51, 0);">usuario@cliente.local:~$

<span style="font-weight: bold;">ntpq&nbsp;</span></span><br 
style="font-family: monospace;"><span style="font-family: monospace;"><span
 style="font-weight: bold;">ntpq&gt; pe</span></span><br><span 
style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;
remote&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
refid&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; st t when poll reach&nbsp;&nbsp;
delay&nbsp;&nbsp; offset&nbsp; jitter</span><br style="color: black;"><span
 style="font-family: monospace; color: black;">==============================================================================</span><br
 style="color: black;"><span style="font-family: monospace; color: 
rgb(255, 102, 0); font-weight: bold;">-servidor1

&nbsp; &nbsp; &nbsp;
.IRIG.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1
u&nbsp;&nbsp;&nbsp; 8&nbsp;&nbsp; 32&nbsp;
377&nbsp;&nbsp;&nbsp;0.407&nbsp;&nbsp;&nbsp; 0.248&nbsp;&nbsp; 0.016</span><br
 style="color: rgb(255, 102, 0); font-weight: bold;"><span 
style="font-family: monospace; color: rgb(255, 102, 0); font-weight: 
bold;">-servidor2

&nbsp; &nbsp; &nbsp;
.GPS.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
1 u&nbsp;&nbsp;&nbsp; -&nbsp;&nbsp; 32&nbsp; 
377&nbsp;&nbsp;&nbsp;0.474&nbsp;&nbsp;&nbsp; 0.213&nbsp;&nbsp; 0.019 </span><br
 style="color: black; font-weight: bold;"><span style="font-family: 
monospace; color: rgb(0, 0, 153); font-weight: bold;">+servidor3

&nbsp; &nbsp; &nbsp;
.GPS.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
1 u&nbsp;&nbsp;&nbsp; 9&nbsp;&nbsp; 64&nbsp; 
377&nbsp;&nbsp;15.680&nbsp;&nbsp; -0.005&nbsp;&nbsp; 0.026 </span><br 
style="color: rgb(0, 0, 153); font-weight: bold;"><span 
style="font-family: monospace; color: black; font-weight: bold;"><span 
style="color: rgb(0, 0, 153);">+servidor4

&nbsp; &nbsp; &nbsp;
.IRIG.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1
u&nbsp;&nbsp; 30&nbsp;&nbsp; 64&nbsp; 
377&nbsp;&nbsp;15.582&nbsp;&nbsp;&nbsp; 0.004&nbsp;&nbsp; 0.100</span> </span><br
 style="color: black; font-weight: bold;"><span style="font-family: 
monospace; color: rgb(0, 102, 0);"><span style="font-weight: bold;">*servidor5&nbsp;

&nbsp;&nbsp;&nbsp;&nbsp;
.GPS.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
1
 u&nbsp;&nbsp; 10&nbsp;&nbsp; 32&nbsp; 
377&nbsp;&nbsp;&nbsp;0.400&nbsp;&nbsp; -0.026&nbsp;&nbsp; 0.049</span> </span><br
 style="color: black;"><span style="font-family: monospace; color: 
rgb(204, 0, 0);">xservidor6

&nbsp; &nbsp; &nbsp;
.IRIG.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1
u&nbsp;&nbsp; 26&nbsp;&nbsp; 64&nbsp;
377&nbsp;&nbsp;&nbsp;7.824&nbsp;&nbsp;&nbsp; 9.923&nbsp;&nbsp; 0.367</span><br
 style="color: black;"><span style="font-family: monospace; color: 
black;">&nbsp;<span style="color: rgb(204, 0, 0);">servidor7

&nbsp; &nbsp; &nbsp;
.INIT.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 16
u&nbsp;&nbsp;&nbsp; - 1024&nbsp;&nbsp;&nbsp; 
0&nbsp;&nbsp;&nbsp;0.000&nbsp;&nbsp;&nbsp; 0.000 4000.00 </span></span><br
 style="color: black;"><span style="font-family: monospace; color: 
rgb(255, 102, 0); font-weight: bold;">-servidor8
&nbsp; &nbsp; &nbsp;

.ACTS.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1
u&nbsp;&nbsp; 13&nbsp;&nbsp; 64&nbsp; 377&nbsp;202.274&nbsp;&nbsp;&nbsp;
 2.459&nbsp;&nbsp; 0.309 </span><br style="color: black;"><span 
style="font-family: monospace; color: black;">&nbsp;<span style="color: 
rgb(153, 0, 0);">LOCAL(0)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
LOCAL(0)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 13 l&nbsp;&nbsp;

48&nbsp;&nbsp; 64&nbsp; 377&nbsp;&nbsp;&nbsp;0.000&nbsp;&nbsp;&nbsp; 
0.000&nbsp;&nbsp; 0.001 </span></span>


<p class="voltar-top"><a href="#inicio" name="Combinação">Voltar</a></p>

<span class="titulo">O Algorítmo de
Combinação de
Relógios</span><br>
<br>Se o algorítmo de Agrupamento encontrar apenas um sobrevivente, ele 
será o <span style="font-weight: bold;">par do sistema</span> e será 
utilizado como <span style="font-weight: bold;">referência para ajustar o
 relógio local</span>. Se for usada a palavra chave&nbsp;<span 
style="font-family: monospace; font-weight: bold;">prefer</span> na 
configuração de um servidor e este estiver <span style="font-weight: 
bold;">dentre os sobreviventes</span>,
ele será considerado como par do sistema e, mesmo que existam
outros sobreviventes, estes serão ignorados. Nesses casos, o
algorítmo de Combinação de Relógios
não é utilizado.<br><br>Para os demais casos,&nbsp;quando há mais do que
 um sobrevivente e nenhum deles foi configurado com a palavra 
chave&nbsp;<span style="font-family: monospace; font-weight: bold;">prefer</span>,
o algorítmo de Combinação de Relógios
calcula uma média ponderada dos deslocamentos dos relógios,
com o objetivo de aumentar a exatidão.<br><br>No exemplo abaixo
os 3 servidores destacados contribuem para o valor de deslocamento de
-0,119ms, mostrado nas variáveis do sistema.<br><span 
style="font-family: monospace; color: rgb(0, 51, 0);"><br><br></span><div
 style="margin-left: 40px;"><span style="font-family: monospace; color: 
rgb(0, 51, 0);">usuario@cliente.local:~$

<span style="font-weight: bold;">ntpq&nbsp;</span></span><br 
style="font-family: monospace;"><span style="font-family: monospace; 
color: rgb(0, 51, 0);"></span><span style="font-family: monospace;"><span
 style="font-weight: bold;"><br>ntpq&gt; pe</span><br>&nbsp;&nbsp;&nbsp;&nbsp;
remote&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
refid&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 st t when poll reach&nbsp;&nbsp;
delay&nbsp;&nbsp; offset&nbsp; jitter<br>==============================================================================<br><span
 style="font-weight: bold; color: rgb(153, 0, 0);">+servidor1

&nbsp; &nbsp; &nbsp;
.IRIG.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1
u&nbsp;&nbsp;&nbsp; 7&nbsp;&nbsp; 16&nbsp; 377&nbsp;&nbsp;&nbsp;
0.410&nbsp;&nbsp; -0.087&nbsp;&nbsp; 0.022</span><br style="font-weight:
 bold; color: rgb(153, 0, 0);"><span style="font-weight: bold; color: 
rgb(153, 0, 0);">*servidor2

&nbsp; &nbsp; &nbsp;
.GPS.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
1 u&nbsp;&nbsp;&nbsp; 7&nbsp;&nbsp; 16&nbsp; 377&nbsp;&nbsp;&nbsp;
0.380&nbsp;&nbsp; -0.128&nbsp;&nbsp; 0.052</span><br style="font-weight:
 bold; color: rgb(153, 0, 0);"><span style="font-weight: bold; color: 
rgb(153, 0, 0);">+servidor3

&nbsp; &nbsp; &nbsp;
.IRIG.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1
u&nbsp;&nbsp;&nbsp; 5&nbsp;&nbsp; 16&nbsp; 377&nbsp;&nbsp;
14.750&nbsp;&nbsp; -0.166&nbsp;&nbsp; 0.076</span><br>-servidor4 &nbsp;

&nbsp; &nbsp; 200.1.2.123&nbsp; &nbsp; &nbsp; 2 u&nbsp;&nbsp;
15&nbsp;&nbsp; 16&nbsp; 377&nbsp;&nbsp;&nbsp; 0.449&nbsp;&nbsp;
-0.466&nbsp;&nbsp; 0.009<br>xservidor5 &nbsp; &nbsp; &nbsp;

.IRIG.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1
u&nbsp;&nbsp; 17&nbsp;&nbsp; 64&nbsp; 377&nbsp;&nbsp;&nbsp;
7.772&nbsp;&nbsp;&nbsp; 9.447&nbsp;&nbsp; 0.186<br>xservidor6 &nbsp;

&nbsp; &nbsp;
.ACTS.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1
u&nbsp;&nbsp; 52&nbsp;&nbsp; 64&nbsp; 377&nbsp;
193.471&nbsp;&nbsp;&nbsp; 5.779&nbsp;&nbsp; 5.444<br>-servidor

&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;
.GPS.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
1 u&nbsp;&nbsp;&nbsp; 9&nbsp;&nbsp; 16&nbsp; 377&nbsp;&nbsp;&nbsp;
0.344&nbsp;&nbsp; -0.486&nbsp;&nbsp; 0.071<br>-servidor &nbsp; &nbsp;

&nbsp; &nbsp;200.1.2.123 &nbsp; &nbsp;&nbsp; 2 u&nbsp;&nbsp;
45&nbsp;&nbsp; 64&nbsp; 377&nbsp;&nbsp;&nbsp; 4.437&nbsp;&nbsp;&nbsp;
1.423&nbsp;&nbsp; 0.723<br><br><span style="font-weight: bold;">ntpq&gt;
 rl</span><br>assID=0 status=06f4 leap_none, sync_ntp, 15 events, 
event_peer/strat_chg,<br>version="ntpd 4.2.2p4@1.1585-o Wed Mar&nbsp; 7 
20:43:30 UTC 2007 (1)",<br>processor="i686", 
system="Linux/2.6.20-16-generic", leap=00, stratum=2,<br>precision=-20, 
rootdelay=0.380, rootdispersion=5.864, peer=40768,<br>refid=servidor2,<br>reftime=cad0765f.9bd22b77&nbsp;
 Mon, Oct 29 2007 13:10:23.608, poll=4,<br>clock=cad07677.9bbc05c3&nbsp;
 Mon, Oct 29 2007 13:10:47.608, state=4,<br><span style="font-weight: 
bold; color: rgb(153, 0, 0);">offset=-0.119</span>, frequency=55.279, 
jitter=0.060, noise=0.014,<br>stability=0.009, tai=0<br><br></span></div><br>No
 exemplo a seguir, apesar de haver 3 sobreviventes, foi usada&nbsp;a 
palavra chave&nbsp;<span style="font-family: monospace; font-weight: 
bold;">prefer</span> na configuração do <span style="font-weight: bold;">servidor5</span>.
Como ele é um dos sobreviventes, foi escolhido como par do
sistema e é o único responsável pelos
parâmetros de sincronização. Nesse caso, o
algorítmo de Combinação de Relógios
não é utilizado:<br><br><div style="margin-left: 40px;"><span 
style="font-family: monospace; color: rgb(0, 51, 0);">usuario@cliente.local:~$

<span style="font-weight: bold;">ntpq&nbsp;</span></span><br 
style="font-family: monospace;"><span style="font-family: monospace; 
color: rgb(0, 51, 0);"></span><span style="font-family: monospace;"><span
 style="font-weight: bold;"><br>ntpq&gt; pe<br><br></span></span><span 
style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;
remote&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
refid&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; st t when poll reach&nbsp;&nbsp;
delay&nbsp;&nbsp; offset&nbsp; jitter</span><br style="font-family: 
monospace;"><span style="font-family: monospace;">==============================================================================</span><br
 style="font-family: monospace;"><span style="font-family: monospace;">-servidor1

&nbsp;
 &nbsp; &nbsp;
.IRIG.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1
u&nbsp;&nbsp;&nbsp; 6&nbsp;&nbsp; 32&nbsp; 377&nbsp;&nbsp;&nbsp;
0.364&nbsp;&nbsp;&nbsp; 0.393&nbsp;&nbsp; 0.032</span><br 
style="font-family: monospace;"><span style="font-family: monospace;">-servidor2

&nbsp;
 &nbsp; &nbsp;
.GPS.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
1 u&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp; 32&nbsp; 377&nbsp;&nbsp;&nbsp;
0.415&nbsp;&nbsp;&nbsp; 0.357&nbsp;&nbsp; 0.012</span><br 
style="font-family: monospace;"><span style="font-family: monospace; 
color: rgb(0, 0, 153);">+servidor3

&nbsp; &nbsp; &nbsp;
.GPS.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
1 u&nbsp;&nbsp; 40&nbsp;&nbsp; 64&nbsp; 377&nbsp;&nbsp;
19.990&nbsp;&nbsp;&nbsp; 0.002&nbsp;&nbsp; 0.019</span><br 
style="font-family: monospace; color: rgb(0, 0, 153);"><span 
style="font-family: monospace; color: rgb(0, 0, 153);">+servidor4

&nbsp; &nbsp; &nbsp;
.IRIG.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1
u&nbsp;&nbsp; 11&nbsp;&nbsp; 64&nbsp; 377&nbsp;&nbsp;
14.804&nbsp;&nbsp;&nbsp; 0.318&nbsp;&nbsp; 0.172</span><br 
style="font-family: monospace; color: rgb(0, 0, 153);"><span 
style="font-family: monospace; color: rgb(0, 0, 153); font-weight: 
bold;">*servidor5&nbsp;

&nbsp;&nbsp;&nbsp;&nbsp;
.GPS.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
1 u&nbsp;&nbsp;&nbsp; 5&nbsp;&nbsp; 32&nbsp; 377&nbsp;&nbsp;&nbsp;
0.366&nbsp;&nbsp; -0.001&nbsp;&nbsp; 0.017</span><br style="font-family:
 monospace;"><span style="font-family: monospace;">xservidor6

&nbsp; &nbsp; &nbsp;
.IRIG.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1
u&nbsp;&nbsp; 19&nbsp;&nbsp; 64&nbsp; 377&nbsp;&nbsp;&nbsp;
7.779&nbsp;&nbsp;&nbsp; 9.969&nbsp;&nbsp; 0.235</span><br 
style="font-family: monospace;"><span style="font-family: monospace;"></span><span
 style="font-family: monospace;"><span style="font-weight: bold;"><br>ntpq&gt;
 rl</span></span><span style="font-family: monospace;"></span><br 
style="font-family: monospace;"><span style="font-family: monospace;">assID=0
 status=0654 leap_none, sync_ntp, 5 events, event_peer/strat_chg,</span><br
 style="font-family: monospace;"><span style="font-family: monospace;">version="ntpd
 4.2.0a@1:4.2.0a+stable-8-r Mon Sep 18 19:09:33 UTC 2006 (1)",</span><br
 style="font-family: monospace;"><span style="font-family: monospace;">processor="i686",
 system="Linux/2.6.17-12-generic", leap=00, stratum=2,</span><br 
style="font-family: monospace;"><span style="font-family: monospace;">precision=-20,
 rootdelay=0.366, rootdispersion=12.913, peer=29992,</span><br 
style="font-family: monospace;"><span style="font-family: monospace;">refid=servidor5,</span><br
 style="font-family: monospace;"><span style="font-family: monospace;">reftime=cad07802.aea704bc&nbsp;
 Mon, Oct 29 2007 13:17:22.682, poll=5,</span><br style="font-family: 
monospace;"><span style="font-family: monospace;">clock=cad0780b.f47980f5&nbsp;
 Mon, Oct 29 2007 13:17:31.954, state=4,</span><br style="font-family: 
monospace;"><span style="font-family: monospace;"><span 
style="font-weight: bold; color: rgb(0, 0, 153);">offset=-0.001</span>, 
frequency=-23.914, noise=0.015, jitter=0.017,</span><br 
style="font-family: monospace;"><span style="font-family: monospace;">stability=0.037</span><br
 style="font-family: monospace;"><span style="font-family: monospace;"></span><br></div>




<p class="voltar-top"><a href="#inicio" name="Disciplina">Voltar</a></p>

<span class="titulo">Disciplina do Relógio
Local</span><br>

<br>O processo de disciplina do Relógio Local controla a fase e
a freqüência do relógio do sistema. Ele é
baseado na combinação de duas filosofias de controle
bastante diferentes entre si: <span style="font-style: italic;">Phase 
Locked Loop (PLL)</span>&nbsp;e <span style="font-style: italic;">Frequency
 Locked Loop (FLL)</span>
(traduções desses termos são incomuns, mas
poderiam ser Laço Controlado por Fase e Laço Controlado
por Freqüência). Ambas as filosofias implementam controles
onde há realimentação, ou seja, onde a
informação de saída é usada novamente na
entrada, como simbolizado na <span style="font-weight: bold;">Figura 2</span>,
 no início desse texto.<br><br>O controle baseado em fase é melhor para 
as ocasiões onde há uma grande variação (<span style="font-style: 
italic;">jitter</span>). Essa abordagem procura minimizar o erro no 
tempo, controlando indiretamente a freqüência.<br><br>O
controle baseado em freqüência é melhor para quando
há instabilidades na freqüência
(variações mais lentas que o <span style="font-style: italic;">jitter</span>,
 conhecidas como <span style="font-style: italic;">wander</span>). A 
abordagem controla diretamente a freqüência, e indiretamente o erro no 
tempo.<br><br>O
NTP disciplina o relógio local de forma contínua, mesmo
em períodos onde não é possível consultar
servidores de tempo. As características do relógio local
são medidas e se tornam conhecidas do NTP, o que torna
possível que ele funcione dessa forma. O arquivo indicado pela
chave <span style="font-family: monospace;"><span style="font-weight: 
bold;">driftfile</span> (</span>geralmente<span style="font-family: 
monospace;"> <span style="font-weight: bold;">/var/lib/ntp/ntp.drift</span></span>)
 na configuração armazena o erro esperado de freqüência para o relógio.<br><br>Algumas
 características importantes desse algorítmo:<br><ul><li>Saltos
no tempo são evitados sempre que possível. O tempo

é ajustado para mais ou para menos gradualmente, variando-se a
freqüência do relógio local.<br><br></li><li>Se uma
diferença maior do que 128ms for detectada o NTP considera que o
tempo está muito errado, e que é necessário um
salto para frente ou para trás para corrigi-lo. Contudo isso
só é feito se essa diferença maior que 128ms
persistir por um período maior que 900s (15min), para evitar que
condições de congestionamento grave mas temporário
na rede, que podem levar a medições erradas de tempo,
causem inadvertidamente esse tipo de salto.<br><br></li><li>Se uma
diferença maior que 1000s (~16,7min) for detectada o
algorítmo aborta a execução, considerando que algo
muito errado aconteceu. Se houver diferenças dessa ordem ou
maiores elas devem ser corrigidas manualmente antes de se executar o <span
 style="font-style: italic;">daemon</span> NTP.</li></ul><br><span 
style="font-weight: bold;"><br></span>


<p class="voltar-top"><a href="#inicio" name="Seguranca">Voltar</a></p>



<span class="titulo">Segurança</span><br><br>Por
segurança no contexto da Tecnologia da Informação
entende-se basicamente garantir quatro propriedades da
informação:<br><ul><li>integridade,</li><li>disponibilidade,</li><li>autenticidade
 e</li><li>confidencialidade.</li></ul>Os
algorítmos vistos anteriormente, aliados à correta
configuração do sistema, com um número suficiente
de fontes de tempo com referências primárias
independentes, garantem de forma satisfatória a <span 
style="font-weight: bold;">integridade</span> e

<span style="font-weight: bold;">disponibilidade</span> do serviço de 
tempo.<br><br>Os
algorítimos de criptografia abordados neste item visam garantir
a <span style="font-weight: bold;">autenticidade</span> da informação. 
Ou seja, têm o
objetivo de assegurar ao cliente de que o servidor é quem ele
diz ser.<br><br>A <span style="font-weight: bold;">confidencialidade</span>
 não é considerada um
problema no contexto do NTP. Ou seja, a informação de
tempo sempre trafega na rede de forma aberta, sem criptografia, mesmo 
quando uma assinatura cifrada é utilizada para
garantir a autenticidade da informação. As razões
principais para o NTP funcionar dessa forma são que:<br><ol><li>o
tempo é uma informação pública, não
há razão para esconder essa informação;</li><li>trabalhar
com a informação de tempo cifrada demandaria tempo tanto
do servidor quando do cliente e degradaria o desempenho do sistema,
fazendo-o menos exato.<br></li></ol>Existem basicamente dois métodos no 
NTP para realizar a autenticação, chave simétrica <span 
style="font-style: italic;">(symmetric key)</span> e &nbsp;chave pública
 <span style="font-style: italic;">(autokey)</span>.<br><br><span 
style="font-weight: bold;">Autenticação por Chave Simétrica <span 
style="font-style: italic;">(Symmetric key)</span></span><br><br>A
autenticação por chave simétrica é o
esquema utilizado originalmente na versão 3 do NTP, mas mantido
da versão 4. Um conjunto de chaves deve ser gerado e
compartilhado entre servidor e cliente. O NTP não fornece meios
para a transmissão ou armazenamento seguro das chaves; isso deve
ser feito com outros recursos.<br><br>Chaves simétricas podem ser usadas
 para:<br><ul><li>autenticar servidores ou pares no modo simétrico 
ativo;</li><li>autenticar pares no modo simétrico passivo ou servidores 
broadcast ou multicast;</li><li>autenticar requisições dos programas de 
monitoração e controle <span style="font-family: monospace; font-weight:
 bold;">ntpq</span> e <span style="font-family: monospace;"><span 
style="font-weight: bold;">ntpdc</span>.</span></li></ul>Quando o daemon
 NTP é iniciado, ele lê o arquivo de chaves especificado pelo comando <tt>keys</tt>
 no arquivo de configuração e armazena-as num cache. Cada chave deve ser
 ativada com o comando <tt style="font-weight: bold;">trustedkey</tt>&nbsp;antes
 de ser usada. Isso pode ser feito com o programa em funcionamento, 
utilizando o <tt><span style="font-weight: bold;">ntpdc</span>.</tt> Os 
comandos <tt style="font-weight: bold;">requestkey</tt>&nbsp;e <tt 
style="font-weight: bold;">controlkey</tt> selecionam as chaves 
utilizadas para autenticar os programas <tt style="font-weight: bold;">ntpdc</tt>
 e <tt style="font-weight: bold;">ntpq</tt>.&nbsp;<p>O
arquivo de chaves pode conter várias chaves, uma em cada linha.
Cada linha tem 3 colunas. A primeira é o número da chave,
entre 1 e 65535. A segunda é o tipo da chave; recomenda-se
utilizar M para MD5, que é representada por uma
seqüência de até 31 caracteres ASCII (A versão
3 do NTP suportava também DES, mas além de ser pior,
há problemas legais nos Estados Unidos, que consideram programas
utilizando DES como munição, proibindo sua
exportação). A terceira é a chave em si.&nbsp;</p>Exemplo de arquivo com
 chaves:<br><br><pre style="margin-left: 40px; font-family: monospace; color: rgb(153, 0, 0); font-weight: bold;" class="SCREEN">1   M    ABCDEFGHIJLMJNOPQRST<br>2   M    ESSAEHUMACHAVEMD5VALIDA<br>3   M    ESSAEHUMACHAVEMD5VALIDATB<br>15  M    1234ACDAS@#$LKAS)KJDKASH<br>498 M    NTPv4.98</pre><br>Exemplo
 de utilização das chaves simétricas na configuração do ntp:<pre style="margin-left: 40px;" class="SCREEN">server servidor1.dominio1 <span style="color: rgb(153, 0, 0); font-weight: bold;">key 498</span><br>server servidor2.dominio2 <span style="color: rgb(153, 0, 0); font-weight: bold;">key 2</span><br>peer   servidor3.dominio3 <span style="color: rgb(153, 0, 0); font-weight: bold;">key 3</span><br style="color: rgb(153, 0, 0);"><br><span style="color: rgb(0, 0, 153);"># caminho para o arquivo com as chaves</span><br><span style="color: rgb(153, 0, 0);"><span style="font-weight: bold;">keys /etc/ntp.keys</span><br><br></span><span style="color: rgb(0, 0, 153);"># define quais chaves são confiáveis</span><br><span style="color: rgb(153, 0, 0); font-weight: bold;">trustedkey 2 15 498</span> <span style="color: rgb(0, 0, 153);"><br><br></span><span style="color: rgb(153, 0, 0); font-weight: bold;">requestkey 15</span>    <span style="color: rgb(0, 0, 153);"># chave para utilizar o ntpq</span><br><span style="color: rgb(153, 0, 0); font-weight: bold;">controlkey 15</span>    <span style="color: rgb(0, 0, 153);"># chave para utilizar o ntpqc</span><br></pre><br><span
 style="font-weight: bold;">Autenticação por Chave Pública <span 
style="font-style: italic;">(Autokey)</span></span><br><br>Na
versão 4 do NTP uma nova forma de autenticação

é suportada,&nbsp;baseada em chaves públicas e num
protocolo que foi chamado de <span style="font-style: italic;">autokey</span>.
A integridade dos pacotes é verificada através de chaves
MD5 e a autenticidade das fontes de tempo é averiguada por meio
de assinaturas digitais e vários esquemas de
autenticação. Esquemas de identificação <span style="font-style: 
italic;">(identity schemes)</span>
baseados em trocas do tipo desafio/resposta são usados para
evitar vários tipos de ataques aos quais o método de
chaves simétricas é potencialmente vulnerável.<br><br>A autenticação é 
baseada em <span style="font-weight: bold;">grupos de segurança</span> <span
 style="font-style: italic;">(security groups). </span>Pode-se entender 
um <span style="font-weight: bold;">grupo de segurança</span>&nbsp;<span
 style="font-style: italic;"></span>como
um conjunto de servidores e clientes NTP que compartilha os mesmos
métodos de autenticação, tendo em sua raiz um ou
mais servidores considerados confiáveis, e administrados por uma
mesma entidade. Um grupo não necessariamente precisa ter
servidores estrato 1 em sua raiz, mas pode ser cliente de outros grupos
de segurança.<br><br>O número de opções que há para configurar-se o <span
 style="font-style: italic;">autokey</span>

é assustador. Contudo a configuração
necessária para a maioria das situações é
relativamente simples. Pode-se configurar um grupo de segurança
com um ou mais servidores confiáveis <span style="font-style: italic;">(TH
 - Trusted Hosts)</span> no estrato mais baixo. Elege-se um desses 
servidores para ser o agente confiável <span style="font-style: italic;">(TA
 - trusted agent)</span>
e gerar os certificados privados, um certificado público auto
assinado, e chaves de identificação privadas. Se houver
mais de um servidor confiável, esses certificados e chaves
são copiados para os demais manualmente.<br><br>Os demais
clientes e servidores geram chaves privadas e certificados auto
assinados considerados não confiáveis. Cada um deles
fornece sua senha ao agente confiável e requisita &nbsp;as
chaves e certificados do grupo (isso pode ser feito por email ou por um
formulário web, por exemplo). Para os servidores são
fornecidas chaves cifradas. Para os clientes somente um subconjunto de
parâmetros de identificação não
criptografados é fornecido.<br><br>O <span style="font-style: italic;">autokey</span>

se encarrega de resgatar os certificados ao longo da cadeia de
servidores NTP até chegar a um servidor confiável,
garantindo que toda a cadeia de servidores é confiável.<br><br>Para
garantir a integridade dos pacotes assinaturas baseadas no
endereço IP são utilizadas. O endereço tem de ser
o mesmo, então, para o cliente e para o servidor, o que
significa que a autenticação baseada em chave
pública <span style="font-weight: bold;">não funciona em conjunto com 
NAT</span>.<br><br>Mais detalhes de configuração do autokey podem ser 
obtidos na documentação oficial do NTP.<br><br><br><span 
style="font-weight: bold;"></span>

<hr>

<br>
<small style="font-weight: bold;"><sup>(1) </sup></small><small 
style="font-weight: bold;">Figuras adaptadas de: </small>TORRES JÚNIOR, 
PEDRO R. <em> Caracterização da Rede de Sincronização na Internet</em>. 
Dissertação de Mestrado. 2007. Universidade Federal do Paraná. 
Curitiba.&nbsp;<br>


<p class="voltar-top"><a href="#inicio">Voltar</a></p>
<!-- fim conteudo --> </td>
<td class="divisa-centro01">&nbsp;</td>
</tr>

</tbody>
</table>
</td>
</tr>
</tbody>
</table>
<!-- Inicio rodape -->
<table class="principal">
<tbody>
<tr>
<td class="rodape03" rowspan="2"></td>
<td>&nbsp;</td>
<td align="center"></td>
</tr>
<tr>
<td class="rodape01"></td>
<td class="rodape02"></td>

</tr>
</tbody>
</table>
<!-- Fim rodape -->
</body></html>